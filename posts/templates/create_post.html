{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    .friends {
        display: none;
    }

    .file-entry {
        background: #1e1e1e;
        padding: 10px;
        border-radius: 8px;
        margin-top: 10px;
    }
</style>

<main class="create-post-page">
    <h2>Create a New Post</h2>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="id_title">Title:</label>
        <div class="create-post-form">{{ form.title }}</div><br>
        <label for="id_description">Description:</label>
        <div class="create-post-form">{{ form.description }}</div><br>
        <label for="id_tags">Tags:</label>
        <div class="create-post-form">{{ form.tags }}</div><br>
        <label for="id_files">Upload Files:</label>
        <div class="create-post-form">
            {{ form.files }}
        </div>

        <div id="file-preview-area"></div>
        <br>
        <button type="submit">Post</button>
    </form>

</main>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const fileInput = document.getElementById('id_files');
        const previewArea = document.getElementById('file-preview-area');

        fileInput.addEventListener('change', (event) => {
            previewArea.innerHTML = '';
            Array.from(event.target.files).forEach((file) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const container = document.createElement('div');
                    container.classList.add('create-post-form', 'file-entry');

                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.alt = file.name;
                    img.style.maxWidth = '100%';
                    img.style.width = 'fit-content';
                    img.style.height = '200px';
                    img.style.borderRadius = '8px';
                    img.style.marginBottom = '8px';
                    img.style.objectFit = 'cover';

                    // helper hint text
                    const hint = document.createElement('pre');
                    hint.textContent = 'ðŸ’¡ Add any details you want here â€” just keep it in this format:\nDetail Title: Detail Value\ne.g. REG: MX07 MBT';
                    hint.style.display = 'block';
                    hint.style.color = '#999';
                    hint.style.marginBottom = '5px';

                    // base template
                    const details = document.createElement('textarea');
                    details.value = 'Reg:\nFleet Number:\nType:\nLocation:\n';
                    details.style.width = '100%';
                    details.style.height = '90px';
                    details.style.fontFamily = 'monospace';
                    details.style.background = '#2a2a2a';
                    details.style.color = '#fff';
                    details.style.border = '1px solid #444';
                    details.style.borderRadius = '6px';
                    details.style.padding = '6px';

                    container.appendChild(img);
                    container.appendChild(details);
                    container.appendChild(hint);
                    previewArea.appendChild(container);
                };
                reader.readAsDataURL(file);
            });
        });
    });
</script>

{% endblock %}