{% extends 'base.html' %}
{% block title %}{{ profile_user.username }}'s Profile{% endblock %}

{% block content %}
<div class="mod-details">
    <div class="asides">
        <div class="aside left">
            <h2 style="font-size: 20px;">@{{ profile_user.username }}</h2>
            <p class="light">Joined: {{ profile_user.date_joined|date:"F j, Y" }}</p>
            <p>
                <strong>{{ posts.count }}</strong> Posts • 
                <strong>{{ profile_user.followers.count }}</strong> Followers • 
                <strong>{{ profile_user.following.count }}</strong> Following
            </p>

            {% if user != profile_user %}
            <button onclick="followUser('{{ profile_user.username }}')" id="followButton">{% if is_following %}Unfollow{% else %}Follow{% endif %}</button>
            {% endif %}

            <hr>

            <h3>Recent Posts</h3>
            {% if posts %}
                <ul>
                    {% for post in posts %}
                        <li style="margin-bottom: 0.8em;">
                            <a href="{% url 'post_detail' post.slug %}" class="post-title">{{ post.title }}</a>
                            <span class="light"> • {{ post.created_at|date:"M j, Y" }}</span>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="light">No posts yet.</p>
            {% endif %}
        </div>

        <div class="aside right">
            <h3>Mods</h3>
            {% if mods %}
                <ul>
                    {% for mod in mods %}
                        <li style="margin-bottom: 0.8em;">
                            <a href="{% url 'mod_detail' mod.id %}" class="post-title">{{ mod.name }}</a>
                            <span class="light"> • Updated {{ mod.updated_at|date:"M j, Y" }}</span>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="light">No mods uploaded yet.</p>
            {% endif %}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('follow-btn');
    if (!btn) return;

    btn.addEventListener('click', async () => {
        const following = btn.dataset.following === 'true';
        const url = following ? '/unfollow/{{ profile_user.username }}/' : '/follow/{{ profile_user.username }}/';
        
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
            },
        });

        if (response.ok) {
            btn.textContent = following ? 'Follow' : 'Unfollow';
            btn.dataset.following = !following;
        }
    });
});
</script>
{% endblock %}
